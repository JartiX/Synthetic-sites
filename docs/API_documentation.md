# Документация по API

В этой документации описаны конечные точки API и их функциональные возможности для взаимодействия с системой. API построен с использованием платформы Flask на Python.

## Аутентификация

Некоторые конечные точки API, которые взаимодействуют с базой данных или с сайтом требуют аутентификации с использованием параметра API-KEY, указанного в параметрах запроса.

## Ошибки

Все ответы от конечных точек API соответствуют стандартному формату JSON для ошибок:

```json
{
 "details": "Сообщение об ошибке"
}
```

# Конечные точки

## Получение данных о локации

- **GET `/api/<site>/get_locations/`**
 - Описание: получение всех локаций определенного сайта.
    - Parameters:
        - `site` (str): Название сайта.
    - Returns:
        - Список мест с их идентификаторами, названиями и категориями.

- **GET `/api/<site>/get_likes_by_id/`**
 - Описание: получение количества лайков для локации по её идентификатору.
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Количество лайков за локацию.

- **GET `/api/<site>/get_visits_by_id/`**
 - Описание: получение статистики посещений локации по её идентификатору.
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Статистика посещений с разбивкой по дням.

- **GET `/api/<site>/get_reviews_by_id/`**
 - Описание: получение отзывов о локации по её идентификатору.
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Список отзывов с «обзором», «рейтингом» и «датой».

- **GET `/api/<site>/get_stats_by_id/`**
 - Описание: получение общей статистики о локации по её идентификатору.
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Словарь со статистикой отзывов, посещений и лайков.

- **GET `/api/<site>/get_name_by_id/`**
 - Описание: получение названия локации по его идентификатору.
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Название места.

- **GET `/api/<site>/get_category_by_id/`**
 - Описание: получение названия категории по идентификатору локации
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Название категории.

- **GET `/api/<site>/get_location_id_by_name/`**
 - Описание: получение идентификатора локации по её названию.
    - Parameters:
        - `site` (str): Название сайта.
        - `name` (str): Название локации.
    - Returns:
        - Идентификатор локации.

- **GET `/api/<site>/get_average_visits_by_id/`**
 - Описание: получение среднего количества посещений локации по её идентификатору.
    - Parameters:
        - `site` (str): Название сайта.
        - `id` (str): идентификатор локации.
    - Returns:
        - Среднее количество посещений.

## Операции администратора (требуются права администратора)

- **DELETE `/api/remove_user_by_id`**
 - Описание: Удаление пользователя по его идентификатору.
    - Parameters:
        - `id` (str): идентификатор пользователя, которого нужно удалить.
    - Returns:
        - Успех: Сообщение об успешном удалении.
        - Сбой: Cообщение об ошибке

- **POST `/api/create_user`**
 - Описание: Создайте нового пользователя (только администратор).
    - Parameters:
        - `username` (str): имя нового пользователя.
        - `email` (str): адрес электронной почты нового пользователя.
        - `password` (str): пароль для нового пользователя.
        - `is_admin` (int): Флаг, указывающий права администратора (0 или 1).
    - Returns:
        - Успех: Сообщение об успешном создании пользователя.
        - Сбой: Cообщение об ошибке

- **PUT `/api/make_admin_by_id`**
 - Описание: Обновление статуса администратора пользователя по его идентификатору.
    - Parameters:
        - `id` (str): идентификатор пользователя.
        - `is_admin` (bool): обновлен статус администратора (True или False).
    - Returns:
        - Успех: Сообщение об успешном обновлении.
        - Сбой: Сообщение об ошибке

- **GET `/api/get_username_by_id`**
 - Описание: Получить имя пользователя по идентификатору пользователя.
    - Parameters:
        - `id` (str): идентификатор пользователя.
    - Returns:
        - Успех: Имя пользователя пользователя.
        - Сбой: Сообщение об ошибке

- **GET `/api/get_email_by_id`**
 - Описание: Получить электронную почту по идентификатору пользователя.
    - Parameters:
        - `id` (str): идентификатор пользователя.
    - Returns:
        - Успех: Электронная почта пользователя.
        - Сбой: Сообщение об ошибке

- **GET `/api/get_id_by_username`**
 - Описание: Получить идентификатор пользователя по имени пользователя.
    - Parameters:
        - `username` (str): имя пользователя.
    - Returns:
        - Успех: Идентификатор пользователя.
        - Сбой: Сообщение об ошибке

- **GET `/api/get_id_by_email`**
 - Описание: Получить идентификатор пользователя по электронной почте.
    - Parameters:
        - `email` (str): адрес электронной почты пользователя.
    - Returns:
        - Успех: Идентификатор пользователя.
        - Сбой: Сообщение об ошибке

- **GET `/api/get_users`**
 - Описание: Получить список всех пользователей.
    - Args:
        `page` (int): страница
        `per_page` (int): количество пользователей на одной странице
    - Returns:
        - Успех: Список пользователей.
        - Сбой: Сообщение об ошибке

## Управление сайтом (требуются права администратора)

- **DELETE `/api/delete_site_from_main_page/`**
 - Описание: Удаление сайта с главной страницы.
    - Parameters:
        - `site` (str): Имя сайта, который нужно удалить.
    - Returns:
        - Успех: Сообщение об успешном удалении.
        - Сбой: Сообщение об ошибке

- **POST/PUT `/api/add_existed_site/`**
 - Описание: Добавьте существующий сайт на главную страницу.
    - Parameters:
        - `site` (str): Имя добавляемого сайта.
        - `city` (str): Название города, связанного с сайтом.
    - Returns:
        - Успех: Сообщение об успешном добавлении.
        - Сбой: Сообщение об ошибке

- **DELETE `/api/delete_site/`**
 - Описание: Полное удаление сайта.
    - Parameters:
        - `site` (str): Имя сайта, который нужно удалить.
    - Returns:
        - Успех: Сообщение об успешном удалении.
        - Сбой: Сообщение об ошибке

- **POST `/api/create_site/`**
- Описание: Генерация нового сайта.
    - Parameters:
        - `site` (str): Имя создаваемого сайта.
        - `city` (str): Название города, связанного с сайтом.
        - `types_of_objects` (dict): категории и список обьектов
        - `min_max_objects` (list/tuple): диапазон обьектов
        - `priority_generate` (bool): приоритет генерации контента
        - `randomize` (bool): нужно ли рандомизировать количество выбранных обьектов
    - Returns:
        - Успех: Сообщение об успешной генерации сайта.
        - Сбой: Сообщение об ошибке

# Ошибки

1. **401 Unauthorized**
    - Ошибка: Отсутствие API-ключа.
    - Описание: Эта ошибка возникает, когда к API обращаются без предоставления API-ключа. Пользователь должен предоставить валидный API-ключ для доступа к этому ресурсу.
    - Пример: 
    ```python
    if not api_key:
        return make_error("Missing API-KEY", 401)
    ```

2. **402 Invalid Value**
    - Ошибка: Некорректное значение параметра.
    - Описание: Эта ошибка возникает когда параметр имеет некорректное значение.
    - Пример:
    ```python
    try:
        is_admin = bool(int(is_admin))
    except ValueError:
        return make_error("Invalid value for is_admin. Expected 0 or 1", 402)
    ```

3. **403 Missing parameters**
    - Ошибка: Недостаточно параметров.
    - Описание:  Эта ошибка возникает, когда не предоставлены необходимые параметры для выполнения запроса.
    - Пример:
    ```python
    if id is None:
        return make_error("Not enought params. Expected params: id", 403)
    ```

4. **404 Not Found**
    - Ошибка: Ресурс не найден.
    - Описание:  Эта ошибка возникает, когда запрашиваемый ресурс не существует
    - Пример:
    ```python
    if not user:
        return make_error("User not found", 404)
    ```

5. **405 Access Denied**
    - Ошибка: Доступ запрещен.
    - Описание:  Эта ошибка возникает, когда у пользователя нет доступа к запрашиваему ресурсу
    - Пример:
    ```python
    if not user.is_admin:
        return make_error("Admin access required", 405)
    ```

6. **406 Not acceptable**
    - Ошибка: Сайт уже существует или уже удален.
    - Описание: Эта ошибка используется в случаях, когда операция не может быть выполнена, так как сайт уже существует или уже был удален.
    - Пример:
    ```python
    if site in sites:
        return make_error(f"Site already exists: {site}:{sites[site]}", 406)
    ```

    ```python
    if site not in sites:
        return make_error("Site already deleted", 406)
    ```

7. **500 Internal Server Error**
    - Ошибка: Внутренняя ошибка сервера.
    - Описание: Эта ошибка возникает, когда происходит исключение или непредвиденная ошибка при обработке запроса.
    - Пример:
    ```python
    except Exception as ex:
        return make_error(ex, 500)
    ```